<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dukan Pro - Ultimate Business Suite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }
        .sidebar {
            width: 280px;
            background-color: #343a40;
            color: #fff;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding-top: 20px;
            transition: transform 0.3s ease;
            z-index: 1050;
        }
        .sidebar .nav-link {
            color: #adb5bd;
            padding: 15px 20px;
            border-left: 5px solid transparent;
            transition: all 0.2s;
        }
        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: #fff;
            background-color: #495057;
            border-left-color: #0d6efd;
        }
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        .main-content {
            margin-left: 280px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }
        /* App is hidden until licensed */
        .main-content.locked, .sidebar.locked, .navbar-toggler.locked {
             display: none;
        }
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: none;
        }
        .card-header {
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            background-color: #0d6efd;
            color: white;
            padding: 15px;
            font-weight: 600;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .form-control, .btn {
            border-radius: 8px;
        }
        .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .btn-primary:hover {
            background-color: #0b5ed7;
            border-color: #0a58ca;
        }
        .table th {
            background-color: #e9ecef;
            color: #495057;
        }
        .table-striped > tbody > tr:nth-of-type(odd) > * {
            --bs-table-bg-type: #f3f4f6;
        }

        /* Mobile Adjustments */
        @media (max-width: 991.98px) {
            .sidebar {
                transform: translateX(-280px);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .main-content.sidebar-open {
                margin-left: 280px;
                overflow-x: hidden;
            }
            .navbar-toggler {
                display: block !important;
            }
        }
        
        .navbar-toggler {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1060;
            display: none; /* Hide by default on desktop */
            background-color: #343a40;
            border-color: #fff;
        }
        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='white' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .hidden {
            display: none !important;
        }

        /* Dashboard specific styles */
        .dashboard-card {
            transition: transform 0.2s;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        /* Utility classes */
        .bg-gradient-primary { background: linear-gradient(45deg, #0d6efd, #00b4d8); }
        .text-shadow { text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1); }
        
        /* --- INVOICE GENERATOR PRO STYLES START --- */
        #invoice-generator h5 {
            font-weight: 600;
        }
        #invoice-preview {
            background: white;
            padding: 25px;
            border: 1px solid #dee2e6;
            min-height: 80vh;
            font-size: 14px;
            color: #333;
            border-radius: 12px; /* Adopt Dukan Pro's card style */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* Adopt Dukan Pro's card style */
        }
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 2px solid #0d6efd;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .shop-details h3 {
            margin: 0;
            color: #0d6efd;
            font-weight: 700;
        }
        #qr-preview img {
            max-width: 100px;
            max-height: 100px;
            border: 1px solid #ccc;
            padding: 3px;
        }
        .customer-details {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .invoice-table {
            width: 100%;
            margin-bottom: 20px;
            border-collapse: collapse; /* Ensure table looks clean */
        }
        .invoice-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .invoice-table th, .invoice-table td {
            padding: 10px;
            text-align: right;
            border-bottom: 1px solid #dee2e6;
        }
        .invoice-table th:first-child, .invoice-table td:first-child {
            text-align: left;
        }
        .invoice-footer {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-top: 20px;
        }
        .totals-table {
            width: 50%;
        }
        .totals-table td {
            padding: 5px 10px;
        }
        .terms {
            font-size: 12px;
            color: #777;
        }
        .no-print { /* Already in Dukan Pro, ensuring consistency */ }
        @media print {
            body * {
                visibility: hidden;
            }
            /* Only make the invoice section visible for print, not the whole body */
            #invoice-generator, #invoice-generator * {
                visibility: visible;
            }
            #invoice-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: none;
                padding: 0;
                margin: 0;
                box-shadow: none;
            }
            .no-print {
                display: none;
            }
        }
        /* --- INVOICE GENERATOR PRO STYLES END --- */
    </style>
</head>
<body>

    <script>
        // --- CONFIGURATION ---
        // üö® IMPORTANT: If you change your Render URL, update this constant.
        const __backend_url = 'https://dukan-pro-ultimate.onrender.com';
        const AppState = {
            currentView: 'dashboard',
            isLicensed: false,
            stock: [],
            sales: [],
            purchases: [],
            customers: [],
            expenses: [],
            stats: {},
            lowStock: [], // Added for dashboard
        };
        const SERVER_TIMEOUT = 15000; // 15 seconds
    </script>

    <div class="modal fade" id="licenseModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="licenseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="licenseModalLabel">Dukan Pro - License Verification</h5>
                </div>
                <form id="license-form">
                    <div class="modal-body">
                        <p>‡§∏‡•â‡§´‡•ç‡§ü‡§µ‡•á‡§Ø‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§≤‡§æ‡§á‡§∏‡•á‡§Ç‡§∏ ‡§ï‡•Ä ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                        <div class="mb-3">
                            <label for="license-key-input" class="form-label fw-bold">‡§≤‡§æ‡§á‡§∏‡•á‡§Ç‡§∏ ‡§ï‡•Ä (License Key)</label>
                            <input type="text" class="form-control" id="license-key-input" required autocomplete="off">
                        </div>
                        <div id="license-message" class="text-danger small mt-2">&nbsp;</div>
                    </div>
                    <div class="modal-footer">
                         <button type="button" class="btn btn-outline-secondary" id="open-admin-login-from-license-btn">‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</button>
                         <button type="submit" class="btn btn-primary" id="license-submit-btn">‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <div class="modal fade" id="adminLoginModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="adminLoginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title" id="adminLoginModalLabel">‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</h5>
                </div>
                <form id="admin-login-form">
                    <div class="modal-body">
                        <p>‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                        <div class="mb-3">
                            <label for="admin-password" class="form-label fw-bold">‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                            <input type="password" class="form-control" id="admin-password" required>
                        </div>
                        <div id="admin-login-message" class="text-danger small mt-2">&nbsp;</div>
                    </div>
                    <div class="modal-footer">
                         <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                         <button type="submit" class="btn btn-dark" id="admin-login-submit-btn">‡§≤‡•â‡§ó‡§ø‡§®</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <div class="ms-3 text-primary" id="loading-message">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
    </div>

    <button class="navbar-toggler locked" type="button" id="menu-toggle">
        <span class="navbar-toggler-icon"></span>
    </button>

    <nav id="sidebar" class="sidebar locked">
        <div class="p-4 d-flex flex-column h-100">
            <h3 class="mb-4 text-white text-shadow"><i class="fas fa-store me-2"></i>Dukan Pro</h3>
            <ul class="nav flex-column mb-auto" id="sidebar-nav">
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="dashboard">
                        <i class="fas fa-home"></i> ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="stock">
                        <i class="fas fa-boxes"></i> ‡§∏‡•ç‡§ü‡•â‡§ï ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="sales">
                        <i class="fas fa-cash-register"></i> ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä (POS)
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-view="invoice-generator">
                        <i class="fas fa-file-invoice"></i> ‡§á‡§®‡§µ‡•â‡§á‡§∏ ‡§ú‡§®‡§∞‡•á‡§ü‡§∞ Pro
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="purchases">
                        <i class="fas fa-shopping-basket"></i> ‡§ñ‡§∞‡•Ä‡§¶
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="crm">
                        <i class="fas fa-users"></i> ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï (CRM)
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="expenses">
                        <i class="fas fa-money-bill-wave"></i> ‡§ñ‡§∞‡•ç‡§ö
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-view="reports">
                        <i class="fas fa-chart-line"></i> ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏
                    </a>
                </li>
            </ul>
            <hr class="text-white-50">
            <div class="text-center">
                <button id="admin-login-btn" class="btn btn-sm btn-outline-light w-100"><i class="fas fa-user-shield me-2"></i>‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</button>
            </div>
            <p class="text-muted mt-2 mb-0 text-center small">v1.0.2 Corrected</p>
        </div>
    </nav>

    <div id="main-content" class="main-content locked">
        <section id="dashboard" class="section">
            <h2 class="mb-4 text-primary">‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</h2>
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <div class="card p-3 dashboard-card bg-white">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-rupee-sign fa-2x text-primary me-3"></i>
                            <div>
                                <p class="text-muted mb-0">‡§ï‡•Å‡§≤ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä (‡§∞‡•á‡§µ‡•á‡§®‡•ç‡§Ø‡•Ç)</p>
                                <h4 class="mb-0" id="total-sales-revenue">‚Çπ0.00</h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card p-3 dashboard-card bg-white">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-boxes fa-2x text-warning me-3"></i>
                            <div>
                                <p class="text-muted mb-0">‡§∏‡•ç‡§ü‡•â‡§ï ‡§Æ‡•Ç‡§≤‡•ç‡§Ø (‡§ñ‡§∞‡•Ä‡§¶)</p>
                                <h4 class="mb-0" id="total-stock-value">‚Çπ0.00</h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card p-3 dashboard-card bg-white">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-users fa-2x text-success me-3"></i>
                            <div>
                                <p class="text-muted mb-0">‡§ï‡•Å‡§≤ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</p>
                                <h4 class="mb-0" id="total-customers">0</h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card p-3 dashboard-card bg-white">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-exclamation-triangle fa-2x text-danger me-3"></i>
                            <div>
                                <p class="text-muted mb-0">‡§ï‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§µ‡§æ‡§≤‡•á ‡§Ü‡§á‡§ü‡§Æ</p>
                                <h4 class="mb-0" id="low-stock-count">0</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4 g-4">
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header bg-gradient-primary">‡§™‡§ø‡§õ‡§≤‡•á 30 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§ï‡•Ä ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä</div>
                        <div class="card-body">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header bg-warning text-dark">‡§ï‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä</div>
                        <div class="card-body">
                            <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                                <table class="table table-sm table-striped mb-0">
                                    <thead>
                                        <tr>
                                            <th>SKU</th>
                                            <th>‡§Ü‡§á‡§ü‡§Æ</th>
                                            <th>Qty</th>
                                        </tr>
                                    </thead>
                                    <tbody id="low-stock-table-body">
                                        <tr><td colspan="3" class="text-center text-muted">‡§ï‡•ã‡§à ‡§ï‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4 g-4">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header bg-success">‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä</div>
                        <div class="card-body">
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-sm table-striped mb-0">
                                    <thead>
                                        <tr>
                                            <th>‡§ö‡§æ‡§≤‡§æ‡§® ‡§®‡§Ç.</th>
                                            <th>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</th>
                                            <th>‡§∞‡§æ‡§∂‡§ø</th>
                                            <th>‡§§‡§ø‡§•‡§ø</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-sales-table-body">
                                        <tr><td colspan="4" class="text-center text-muted">‡§ï‡•ã‡§à ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header bg-info">‡§π‡§æ‡§≤ ‡§ï‡•á ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</div>
                        <div class="card-body">
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-sm table-striped mb-0">
                                    <thead>
                                        <tr>
                                            <th>‡§®‡§æ‡§Æ</th>
                                            <th>‡§´‡§º‡•ã‡§®</th>
                                            <th>‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-customers-table-body">
                                        <tr><td colspan="3" class="text-center text-muted">‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="stock" class="section">
            <h2 class="mb-4 text-primary">‡§∏‡•ç‡§ü‡•â‡§ï ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</h2>
            <div class="card mb-4">
                <div class="card-header">‡§®‡§Ø‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</div>
                <div class="card-body">
                    <form id="add-stock-form" class="row g-3">
                        <div class="col-md-3">
                            <label for="stock-sku" class="form-label">SKU / ‡§ï‡•ã‡§°</label>
                            <input type="text" class="form-control" id="stock-sku" required>
                        </div>
                        <div class="col-md-5">
                            <label for="stock-name" class="form-label">‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                            <input type="text" class="form-control" id="stock-name" required>
                        </div>
                        <div class="col-md-2">
                            <label for="stock-quantity" class="form-label">‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (Qty)</label>
                            <input type="number" class="form-control" id="stock-quantity" required min="0">
                        </div>
                         <div class="col-md-2">
                             <label for="stock-unit" class="form-label">‡§á‡§ï‡§æ‡§à</label>
                             <input type="text" class="form-control" id="stock-unit" value="Pcs" placeholder="e.g., Pcs, Kg, Ltr" required>
                         </div>
                        <div class="col-md-3">
                            <label for="stock-purchase-price" class="form-label">‡§ñ‡§∞‡•Ä‡§¶ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø (‚Çπ)</label>
                            <input type="number" step="0.01" class="form-control" id="stock-purchase-price" required min="0">
                        </div>
                        <div class="col-md-3">
                            <label for="stock-sale-price" class="form-label">‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§Æ‡•Ç‡§≤‡•ç‡§Ø (‚Çπ)</label>
                            <input type="number" step="0.01" class="form-control" id="stock-sale-price" required min="0">
                        </div>
                        <div class="col-md-3">
                            <label for="stock-gst" class="form-label">GST (%)</label>
                            <input type="number" step="0.01" class="form-control" id="stock-gst" value="0" min="0">
                        </div>
                        <div class="col-12 mt-4">
                            <button type="submit" class="btn btn-primary w-100">‡§∏‡•ç‡§ü‡•â‡§ï ‡§Æ‡•á‡§Ç ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§∏‡•ç‡§ü‡•â‡§ï ‡§∏‡•Ç‡§ö‡•Ä</div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>SKU</th>
                                    <th>‡§Ü‡§á‡§ü‡§Æ</th>
                                    <th>Qty</th>
                                    <th>‡§á‡§ï‡§æ‡§à</th>
                                    <th>‡§ñ‡§∞‡•Ä‡§¶ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</th>
                                    <th>‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</th>
                                    <th>GST %</th>
                                    <th>‡§è‡§ï‡•ç‡§∂‡§®</th>
                                </tr>
                            </thead>
                            <tbody id="stock-table-body">
                                <tr><td colspan="8" class="text-center text-muted">‡§ï‡•ã‡§à ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="sales" class="section">
            <h2 class="mb-4 text-primary">‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä (‡§™‡•â‡§á‡§Ç‡§ü ‡§ë‡§´ ‡§∏‡•á‡§≤)</h2>
            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">‡§®‡§Ø‡§æ ‡§ö‡§æ‡§≤‡§æ‡§® ‡§¨‡§®‡§æ‡§è‡§Ç</div>
                        <div class="card-body">
                            <form id="pos-form">
                                <div class="mb-3">
                                    <label for="pos-customer" class="form-label">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                                    <input type="text" class="form-control" id="pos-customer" list="customer-datalist" placeholder="‡§Ö‡§®‡§æ‡§Æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç">
                                    <datalist id="customer-datalist"></datalist>
                                </div>

                                <div class="mb-3 position-relative">
                                    <label for="pos-item-search" class="form-label">‡§Ü‡§á‡§ü‡§Æ ‡§ñ‡•ã‡§ú‡•á‡§Ç / SKU</label>
                                    <input type="text" class="form-control" id="pos-item-search" placeholder="‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ SKU ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç" autocomplete="off">
                                    <ul id="pos-search-results" class="list-group position-absolute w-100" style="z-index: 100;"></ul>
                                </div>
                                <hr>

                                <h5>‡§¨‡§ø‡§≤‡§ø‡§Ç‡§ó ‡§ï‡§æ‡§∞‡•ç‡§ü</h5>
                                <div class="table-responsive mb-3" style="min-height: 150px;">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>‡§Ü‡§á‡§ü‡§Æ</th>
                                                <th style="width: 15%;">Qty</th>
                                                <th>‡§¶‡§∞</th>
                                                <th>‡§ï‡•Å‡§≤</th>
                                                <th style="width: 1%;"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="pos-cart-body">
                                            <tr><td colspan="5" class="text-center text-muted">‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à‡•§</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="d-flex justify-content-between fw-bold mb-2">
                                    <span>‡§ï‡•Å‡§≤ ‡§ü‡•à‡§ï‡•ç‡§∏‡•á‡§¨‡§≤ ‡§∞‡§æ‡§∂‡§ø:</span>
                                    <span id="pos-subtotal">‚Çπ0.00</span>
                                </div>
                                <div class="d-flex justify-content-between fw-bold mb-2 text-danger">
                                    <span>‡§ï‡•Å‡§≤ GST ‡§∞‡§æ‡§∂‡§ø:</span>
                                    <span id="pos-gst-amount">‚Çπ0.00</span>
                                </div>
                                <div class="d-flex justify-content-between fw-bold fs-5 border-top pt-2">
                                    <span>‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡•Ä ‡§ú‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</span>
                                    <span id="pos-total-amount">‚Çπ0.00</span>
                                </div>

                                <div class="mt-4">
                                    <button type="button" class="btn btn-success btn-lg w-100" id="complete-sale-btn">‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§ï‡§∞‡•á‡§Ç</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">‡§π‡§æ‡§≤ ‡§ï‡•á ‡§ö‡§æ‡§≤‡§æ‡§®</div>
                        <div class="card-body">
                            <div class="mb-3 d-flex justify-content-end">
                                <button class="btn btn-sm btn-outline-secondary" id="refresh-sales-btn"><i class="fas fa-sync-alt"></i> ‡§§‡§æ‡§ú‡§º‡§æ ‡§ï‡§∞‡•á‡§Ç</button>
                            </div>
                            <div class="table-responsive" style="max-height: 700px; overflow-y: auto;">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>‡§ö‡§æ‡§≤‡§æ‡§® ‡§®‡§Ç.</th>
                                            <th>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</th>
                                            <th>‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø</th>
                                            <th>‡§§‡§ø‡§•‡§ø</th>
                                            <th>‡§è‡§ï‡•ç‡§∂‡§®</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sales-table-body">
                                        <tr><td colspan="5" class="text-center text-muted">‡§ï‡•ã‡§à ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§®‡§π‡•Ä‡§Ç‡•§</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="invoice-generator" class="section active">
            <h2 class="mb-4 text-primary">üáÆüá≥ India's Best Invoice Generator Pro</h2>
            <div class="row g-4">
                <div class="col-lg-5 no-print">
                    <div class="card">
                        <div class="card-header">
                            <h2>üìù Create New Invoice</h2>
                        </div>
                        <div class="card-body p-4">
                            <div class="row g-3 mb-4">
                                <h5>üè™ Shop Details</h5>
                                <div class="col-md-6">
                                    <input type="text" id="shopName" class="form-control" placeholder="Shop Name" onkeyup="updateInvoicePreview()">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" id="shopContact" class="form-control" placeholder="Contact No." onkeyup="updateInvoicePreview()">
                                </div>
                                <div class="col-12">
                                    <input type="text" id="shopAddress" class="form-control" placeholder="Shop Address" onkeyup="updateInvoicePreview()">
                                </div>
                                 <div class="col-md-6">
                                     <input type="text" id="shopGstin" class="form-control" placeholder="GSTIN (Optional)" onkeyup="updateInvoicePreview()">
                                 </div>
                                 <div class="col-md-6">
                                     <label for="qrUpload" class="form-label small">Upload Payment QR</label>
                                     <input type="file" id="qrUpload" class="form-control form-control-sm" accept="image/*">
                                 </div>
                            </div>
        
                            <div class="row g-3 mb-4">
                                <h5>üë§ Customer Details</h5>
                                 <div class="col-md-6">
                                     <input type="text" id="customerName" class="form-control" placeholder="Customer Name" onkeyup="updateInvoicePreview()">
                                 </div>
                                 <div class="col-md-6">
                                     <input type="text" id="customerContact" class="form-control" placeholder="Contact No." onkeyup="updateInvoicePreview()">
                                 </div>
                                <div class="col-12">
                                    <input type="text" id="customerAddress" class="form-control" placeholder="Customer Address" onkeyup="updateInvoicePreview()">
                                </div>
                            </div>
        
                            <h5 class="mb-3">‚ûï Add Items</h5>
                            <div class="row g-2 align-items-center" id="item-form">
                                <div class="col-sm-12 mb-2">
                                    <input type="text" id="itemName" class="form-control" placeholder="Item Name">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" id="quantity" class="form-control" placeholder="Qty">
                                </div>
                                 <div class="col-sm-4">
                                     <input type="number" id="price" class="form-control" placeholder="Rate">
                                 </div>
                                 <div class="col-sm-3">
                                     <input type="number" id="gst" class="form-control" placeholder="GST %">
                                 </div>
                                <div class="col-sm-2">
                                    <button class="btn btn-success w-100" onclick="addItem()">Add</button>
                                </div>
                            </div>
                            <hr>
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button class="btn btn-primary" onclick="saveAndDownloadInvoicePDF()">‚¨áÔ∏è Download PDF</button>
                                <button class="btn btn-info text-white" onclick="printInvoice()">üñ®Ô∏è Print Invoice</button>
                                <button class="btn btn-danger" onclick="clearBill()">üóëÔ∏è Clear Bill</button>
                            </div>
                        </div>
                    </div>
                </div>
        
                <div class="col-lg-7">
                    <div id="invoice-preview">
                        <div class="text-center text-muted p-5">Please fill details and add items to see the invoice preview.</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="purchases" class="section">
            <h2 class="mb-4 text-primary">‡§ñ‡§∞‡•Ä‡§¶ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°</h2>
            <div class="card mb-4">
                <div class="card-header">‡§®‡§à ‡§ñ‡§∞‡•Ä‡§¶ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</div>
                <div class="card-body">
                    <form id="add-purchase-form" class="row g-3">
                        <div class="col-md-4">
                            <label for="purchase-bill-number" class="form-label">‡§¨‡§ø‡§≤ / ‡§ö‡§æ‡§≤‡§æ‡§® ‡§®‡§Ç.</label>
                            <input type="text" class="form-control" id="purchase-bill-number" required>
                        </div>
                        <div class="col-md-4">
                            <label for="purchase-supplier" class="form-label">‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                            <input type="text" class="form-control" id="purchase-supplier" required>
                        </div>
                        <div class="col-md-4">
                            <label for="purchase-total-cost" class="form-label">‡§ï‡•Å‡§≤ ‡§¨‡§ø‡§≤ ‡§∞‡§æ‡§∂‡§ø (‚Çπ)</label>
                            <input type="number" step="0.01" class="form-control" id="purchase-total-cost" required min="0">
                        </div>
                        <hr class="my-3 col-12">
                        <h6 class="col-12">‡§ñ‡§∞‡•Ä‡§¶‡•á ‡§ó‡§è ‡§Ü‡§á‡§ü‡§Æ</h6>
                        <div id="purchase-items-container" class="col-12">
                        </div>
                        <div class="col-12">
                            <button type="button" id="add-purchase-item-btn" class="btn btn-sm btn-outline-secondary">
                                <i class="fas fa-plus"></i> ‡§î‡§∞ ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                            </button>
                        </div>
                        <div class="col-12 mt-4">
                            <button type="submit" class="btn btn-success w-100">‡§ñ‡§∞‡•Ä‡§¶ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§ñ‡§∞‡•Ä‡§¶ ‡§ï‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏</div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>‡§¨‡§ø‡§≤ ‡§®‡§Ç.</th>
                                    <th>‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø‡§ï‡§∞‡•ç‡§§‡§æ</th>
                                    <th>‡§Ü‡§á‡§ü‡§Æ</th>
                                    <th>‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø</th>
                                    <th>‡§§‡§ø‡§•‡§ø</th>
                                    <th>‡§è‡§ï‡•ç‡§∂‡§®</th>
                                </tr>
                            </thead>
                            <tbody id="purchases-table-body">
                                <tr><td colspan="6" class="text-center text-muted">‡§ï‡•ã‡§à ‡§ñ‡§∞‡•Ä‡§¶ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="crm" class="section">
            <h2 class="mb-4 text-primary">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡§Ç‡§¨‡§Ç‡§ß ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® (CRM)</h2>
            <div class="card mb-4">
                <div class="card-header">‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</div>
                <div class="card-body">
                    <form id="add-customer-form" class="row g-3">
                        <div class="col-md-4">
                            <label for="customer-name" class="form-label">‡§®‡§æ‡§Æ</label>
                            <input type="text" class="form-control" id="customer-name" required>
                        </div>
                        <div class="col-md-4">
                            <label for="customer-phone" class="form-label">‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞</label>
                            <input type="tel" class="form-control" id="customer-phone">
                        </div>
                        <div class="col-md-4">
                            <label for="customer-email" class="form-label">‡§à‡§Æ‡•á‡§≤ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)</label>
                            <input type="email" class="form-control" id="customer-email">
                        </div>
                        <div class="col-12">
                            <label for="customer-address" class="form-label">‡§™‡§§‡§æ (Address)</label>
                            <textarea class="form-control" id="customer-address" rows="1"></textarea>
                        </div>
                        <div class="col-12 mt-4">
                            <button type="submit" class="btn btn-primary w-100">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="card">
                <div class="card-header">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡•Ç‡§ö‡•Ä</div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>‡§®‡§æ‡§Æ</th>
                                    <th>‡§´‡§º‡•ã‡§®</th>
                                    <th>‡§™‡§§‡§æ</th>
                                    <th>‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ</th>
                                    <th>‡§è‡§ï‡•ç‡§∂‡§®</th>
                                </tr>
                            </thead>
                            <tbody id="crm-table-body">
                                <tr><td colspan="6" class="text-center text-muted">‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="expenses" class="section">
            <h2 class="mb-4 text-primary">‡§ñ‡§∞‡•ç‡§ö ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</h2>
            <div class="card mb-4">
                <div class="card-header">‡§®‡§Ø‡§æ ‡§ñ‡§∞‡•ç‡§ö ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</div>
                <div class="card-body">
                    <form id="add-expense-form" class="row g-3">
                        <div class="col-md-4">
                            <label for="expense-date" class="form-label">‡§§‡§ø‡§•‡§ø</label>
                            <input type="date" class="form-control" id="expense-date" value="" required>
                        </div>
                        <div class="col-md-4">
                            <label for="expense-category" class="form-label">‡§∂‡•ç‡§∞‡•á‡§£‡•Ä</label>
                            <select class="form-select" id="expense-category" required>
                                <option value="" disabled selected>‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</option>
                                <option value="Salary">‡§µ‡•á‡§§‡§® (Salary)</option>
                                <option value="Rent">‡§ï‡§ø‡§∞‡§æ‡§Ø‡§æ (Rent)</option>
                                <option value="Utilities">‡§Ø‡•Ç‡§ü‡§ø‡§≤‡§ø‡§ü‡•Ä‡§ú (‡§¨‡§ø‡§ú‡§≤‡•Ä/‡§™‡§æ‡§®‡•Ä)</option>
                                <option value="Marketing">‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü‡§ø‡§Ç‡§ó</option>
                                <option value="Miscellaneous">‡§µ‡§ø‡§µ‡§ø‡§ß</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="expense-amount" class="form-label">‡§∞‡§æ‡§∂‡§ø (‚Çπ)</label>
                            <input type="number" step="0.01" class="form-control" id="expense-amount" required min="0">
                        </div>
                        <div class="col-12">
                            <label for="expense-description" class="form-label">‡§µ‡§ø‡§µ‡§∞‡§£</label>
                            <input type="text" class="form-control" id="expense-description" required>
                        </div>
                        <div class="col-12 mt-4">
                            <button type="submit" class="btn btn-warning w-100">‡§ñ‡§∞‡•ç‡§ö ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="card">
                <div class="card-header">‡§ñ‡§∞‡•ç‡§ö ‡§ï‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏</div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>‡§§‡§ø‡§•‡§ø</th>
                                    <th>‡§∂‡•ç‡§∞‡•á‡§£‡•Ä</th>
                                    <th>‡§µ‡§ø‡§µ‡§∞‡§£</th>
                                    <th>‡§∞‡§æ‡§∂‡§ø</th>
                                    <th>‡§è‡§ï‡•ç‡§∂‡§®</th>
                                </tr>
                            </thead>
                            <tbody id="expenses-table-body">
                                <tr><td colspan="5" class="text-center text-muted">‡§ï‡•ã‡§à ‡§ñ‡§∞‡•ç‡§ö ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="reports" class="section">
            <h2 class="mb-4 text-primary">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§è‡§®‡§æ‡§≤‡§ø‡§ü‡§ø‡§ï‡•ç‡§∏</h2>
            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header bg-success">‡§≤‡§æ‡§≠ ‡§î‡§∞ ‡§π‡§æ‡§®‡§ø (Profit & Loss)</div>
                        <div class="card-body">
                            <p>‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§≤‡§æ‡§≠/‡§π‡§æ‡§®‡§ø ‡§ï‡•Ä ‡§ó‡§£‡§®‡§æ ‡§Ø‡§π‡§æ‡§Å ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§ø‡§§ ‡§π‡•ã‡§ó‡•Ä‡•§ (API Integration required)</p>
                            <ul class="list-group">
                                <li class="list-group-item d-flex justify-content-between">‡§ï‡•Å‡§≤ ‡§∞‡•á‡§µ‡•á‡§®‡•ç‡§Ø‡•Ç: <span id="report-revenue">‚Çπ0.00</span></li>
                                <li class="list-group-item d-flex justify-content-between">‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•Ä‡§¶: <span id="report-purchases">‚Çπ0.00</span></li>
                                <li class="list-group-item d-flex justify-content-between">‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö: <span id="report-expenses">‚Çπ0.00</span></li>
                                <li class="list-group-item d-flex justify-content-between fw-bold text-primary">‡§∂‡•Å‡§¶‡•ç‡§ß ‡§≤‡§æ‡§≠ (Net Profit): <span id="report-profit">‚Çπ0.00</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header bg-info">‡§∂‡•Ä‡§∞‡•ç‡§∑ ‡§¨‡§ø‡§ï‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§Ü‡§á‡§ü‡§Æ (Top Selling Items)</div>
                        <div class="card-body">
                            <canvas id="topItemsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="appToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title"></strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-body">
                Hello, world! This is a toast message.
            </div>
        </div>
    </div>


    <script>
        // --- INVOICE GENERATOR PRO VARIABLES (New) ---
        let items = [];
        let qrCodeImage = '';
        // --- END INVOICE GENERATOR PRO VARIABLES ---

        // Dukan Pro Core Functions (fetchApi, showMessage, renderView etc.)
        const showLoader = (message = '‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...') => {
            document.getElementById('loading-message').innerText = message;
            document.getElementById('loading-overlay').classList.remove('hidden');
        };

        const hideLoader = () => {
            document.getElementById('loading-overlay').classList.add('hidden');
        };

        const showMessage = (title, body, type = 'primary') => {
            const toastElement = document.getElementById('appToast');
            const toastTitle = document.getElementById('toast-title');
            const toastBody = document.getElementById('toast-body');
            
            toastTitle.innerText = title;
            toastBody.innerText = body;

            // Update header class for color
            toastElement.querySelector('.toast-header').className = `toast-header bg-${type} text-white`;

            const toast = new bootstrap.Toast(toastElement);
            toast.show();
        };

        const fetchApi = async (endpoint, options = {}, loadingMessage = '‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...') => {
            showLoader(loadingMessage);
            const defaultOptions = {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('licenseKey')}`
                },
            };
            const finalOptions = { ...defaultOptions, ...options };
            if (options.body) {
                finalOptions.body = JSON.stringify(options.body);
            }

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), SERVER_TIMEOUT);
                finalOptions.signal = controller.signal;

                const response = await fetch(`${__backend_url}${endpoint}`, finalOptions);
                clearTimeout(timeoutId);

                hideLoader();
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: response.statusText }));
                    throw new Error(errorData.message || 'Server error');
                }
                return response.json();
            } catch (error) {
                hideLoader();
                if (error.name === 'AbortError') {
                    throw new Error('Server took too long to respond.');
                }
                throw error;
            }
        };

        const renderView = (viewId) => {
            AppState.currentView = viewId;
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(viewId).classList.add('active');

            document.querySelectorAll('#sidebar-nav .nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-view') === viewId) {
                    link.classList.add('active');
                }
            });

            // Specific action for the new invoice generator
            if (viewId === 'invoice-generator') {
                updateInvoicePreview();
                initializeQRUpload(); // Ensure QR listener is set up
            }
            // Add similar logic for other views here
        };

// --- NEW: FETCH AND RENDER STOCK LIST ---
async function fetchAndRenderStockList() {
    const tableBody = document.getElementById('stock-table-body');
    if (!tableBody) return;

    tableBody.innerHTML = `<tr><td colspan="7" class="text-center">‡§∏‡•ç‡§ü‡•â‡§ï ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</td></tr>`;

    try {
        // üî¥ NEW API CALL: /api/stocks
        const response = await fetchApi('/api/stocks', { method: 'GET' });

        if (response.success && response.stocks.length > 0) {
            tableBody.innerHTML = '';
            response.stocks.forEach(item => {
                const row = document.createElement('tr');
                // ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§™‡§ï‡•á ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ü‡•á‡§¨‡§≤ ‡§Æ‡•á‡§Ç 7 ‡§ï‡•â‡§≤‡§Æ ‡§π‡•à‡§Ç (SKU, Item Name, Quantity, Unit, P. Price, S. Price, GST)
                row.innerHTML = `
                    <td>${item.SKU}</td>
                    <td>${item['Item Name']}</td>
                    <td>${item.Quantity} ${item.Unit}</td>
                    <td>‚Çπ${item['Purchase Price'].toFixed(2)}</td>
                    <td>‚Çπ${item['Sale Price'].toFixed(2)}</td>
                    <td>${item.GST}%</td>
                    <td>${new Date(item['Last Updated']).toLocaleString()}</td>
                `;
                tableBody.appendChild(row);
            });
        } else {
            tableBody.innerHTML = `<tr><td colspan="7" class="text-center">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</td></tr>`;
        }
    } catch (error) {
        tableBody.innerHTML = `<tr><td colspan="7" class="text-center text-danger">‡§∏‡•ç‡§ü‡•â‡§ï ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ${error.message}</td></tr>`;
        console.error('Error in fetchAndRenderStockList:', error);
    }
}

function setupStockTab() {
    // ... (‡§Ü‡§™‡§ï‡§æ ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§ï‡•ã‡§°)

    stockForm.addEventListener('submit', async (e) => {
        // ... (‡§Ü‡§™‡§ï‡§æ ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§´‡•â‡§∞‡•ç‡§Æ ‡§∏‡§¨‡§Æ‡§ø‡§∂‡§® ‡§≤‡•â‡§ú‡§ø‡§ï)
        try {
            // ... (API ‡§ï‡•â‡§≤)

            if (response.success) {
                showMessage('‡§∏‡§´‡§≤‡§§‡§æ', `‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ü‡§á‡§ü‡§Æ ${data['Item Name']} ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ/‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§`, 'success');
                stockForm.reset(); 
                
                // üî¥ FIX: ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ï‡•ã ‡§∞‡•Ä‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
                await fetchAndRenderStockList(); 

            } else {
                // ...
            }
        } catch (error) {
           // ...
        } finally {
            // ...
        }
    });

    // üî¥ FIX: ‡§ú‡§¨ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ü‡•à‡§¨ ‡§™‡§π‡§≤‡•Ä ‡§¨‡§æ‡§∞ ‡§ñ‡•Å‡§≤‡§§‡§æ ‡§π‡•à, ‡§§‡§¨ ‡§≠‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ï‡•ã ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
    fetchAndRenderStockList();
}


        
// --- NEW: STOCK TAB LOGIC ---
function setupStockTab() {
    const stockForm = document.getElementById('add-stock-form');
    const stockTableBody = document.getElementById('stock-table-body');
    
    // ‡§Ø‡§¶‡§ø ‡§´‡•â‡§∞‡•ç‡§Æ ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à, ‡§§‡•ã ‡§≤‡§ø‡§∏‡§®‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
    if (stockForm) {
        stockForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = stockForm.querySelector('button[type="submit"]');
            const formElements = stockForm.elements;

            // ‡§´‡•â‡§∞‡•ç‡§Æ ‡§°‡•á‡§ü‡§æ ‡§á‡§ï‡§ü‡•ç‡§†‡§æ ‡§ï‡§∞‡•á‡§Ç
            const data = {
                SKU: formElements['stock-sku'].value,
                'Item Name': formElements['stock-name'].value,
                Quantity: parseFloat(formElements['stock-quantity'].value) || 0,
                Unit: formElements['stock-unit'].value,
                'Purchase Price': parseFloat(formElements['stock-purchase-price'].value) || 0,
                'Sale Price': parseFloat(formElements['stock-sale-price'].value) || 0,
                GST: parseFloat(formElements['stock-gst'].value) || 0,
            };

            btn.disabled = true;
            btn.innerHTML = `<span class="spinner-border spinner-border-sm"></span> ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ú‡•ã‡§°‡§º ‡§∞‡§π‡§æ ‡§π‡•à...`;

            try {
                // üî¥ API call to save stock
                const response = await fetchApi('/api/stock', { 
                    method: 'POST', 
                    body: data 
                }, '‡§∏‡•ç‡§ü‡•â‡§ï ‡§∏‡•á‡§µ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...');

                if (response.success) {
                    showMessage('‡§∏‡§´‡§≤‡§§‡§æ', `‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ü‡§á‡§ü‡§Æ ${data['Item Name']} ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ‡•§`, 'success');
                    stockForm.reset(); // ‡§´‡•â‡§∞‡•ç‡§Æ ‡§ï‡•ã ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                    // Fetch and render stock list here (or after unlock)
                } else {
                    throw new Error(response.message || '‡§∏‡•ç‡§ü‡•â‡§ï ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤‡§§‡§æ‡•§');
                }
            } catch (error) {
                // ‡§´‡•â‡§∞‡•ç‡§Æ ‡§Æ‡•á‡§Ç ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à dedicated element ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§ü‡•ã‡§∏‡•ç‡§ü ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç
                showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø', `‡§∏‡•ç‡§ü‡•â‡§ï ‡§∏‡•á‡§µ ‡§è‡§∞‡§∞: ${error.message}`, 'danger');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '‡§∏‡•ç‡§ü‡•â‡§ï ‡§Æ‡•á‡§Ç ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç';
            }
        });
    }
}
// --- END STOCK TAB LOGIC ---

    const unlockApplication = () => {
    AppState.isLicensed = true;
    document.getElementById('sidebar').classList.remove('locked');
    document.getElementById('main-content').classList.remove('locked');
    document.getElementById('menu-toggle').classList.remove('locked');
    
    // Initial data fetch and rendering
    // fetchDataAndRenderDashboard(); // Dukan Pro's original logic
    renderView('invoice-generator'); // Show the new invoice generator by default after unlock
    
    // üî¥ FIX: ‡§∏‡•ç‡§ü‡•â‡§ï ‡§´‡•â‡§∞‡•ç‡§Æ ‡§≤‡•â‡§ú‡§ø‡§ï ‡§ï‡•ã ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç
    setupStockTab(); 
};

        // --- NEW INVOICE GENERATOR PRO FUNCTIONS ---

        /**
         * Initializes the QR code upload listener.
         */
        function initializeQRUpload() {
            const qrUpload = document.getElementById('qrUpload');
            if (!qrUpload.hasAttribute('data-initialized')) {
                qrUpload.setAttribute('data-initialized', 'true');
                qrUpload.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            qrCodeImage = e.target.result;
                            updateInvoicePreview();
                        }
                        reader.readAsDataURL(file);
                    }
                });
            }
        }

        function addItem() {
            const itemName = document.getElementById("itemName").value;
            const quantity = parseFloat(document.getElementById("quantity").value) || 0;
            const price = parseFloat(document.getElementById("price").value) || 0;
            const gst = parseFloat(document.getElementById("gst").value) || 0;

            if (!itemName || quantity <= 0 || price <= 0) {
                showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø', "‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡•à‡§ß ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ, ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§î‡§∞ ‡§¶‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§", 'danger');
                return;
            }

            const amount = price * quantity;
            const gstAmount = amount * (gst / 100);
            const total = amount + gstAmount;

            items.push({ itemName, quantity, price, gst, amount, gstAmount, total });
            updateInvoicePreview();
            
            document.getElementById("itemName").value = '';
            document.getElementById("quantity").value = '';
            document.getElementById("price").value = '';
            document.getElementById("gst").value = '';
            document.getElementById("itemName").focus();
        }

        function deleteItem(index) {
            items.splice(index, 1);
            updateInvoicePreview();
        }

        function updateInvoicePreview() {
            const invoicePreview = document.getElementById('invoice-preview');
            // Use fallback values if inputs are empty
            const shopName = document.getElementById('shopName').value || 'Your Shop Name';
            const shopAddress = document.getElementById('shopAddress').value || 'Your Shop Address';
            const shopContact = document.getElementById('shopContact').value || 'Contact: +91 00000 00000';
            const shopGstin = document.getElementById('shopGstin').value || 'GSTIN: Not Available';
            
            const customerName = document.getElementById('customerName').value || 'Walk-in Customer';
            const customerAddress = document.getElementById('customerAddress').value || 'N/A';
            const customerContact = document.getElementById('customerContact').value || '';

            let subTotal = 0;
            let totalCgst = 0;
            let totalSgst = 0;

            items.forEach(item => {
                subTotal += item.amount;
                totalCgst += (item.amount * (item.gst / 2 / 100));
                totalSgst += (item.amount * (item.gst / 2 / 100));
            });
            const grandTotal = subTotal + totalCgst + totalSgst;

            let itemsHtml = items.map((item, index) => `
                <tr>
                    <td>${index + 1}. ${item.itemName}</td>
                    <td>${item.quantity} ${item.unit || ''}</td>
                    <td>‚Çπ${item.price.toFixed(2)}</td>
                    <td>${item.gst}%</td>
                    <td>‚Çπ${item.total.toFixed(2)}</td>
                    <td class="no-print"><button class="btn btn-danger btn-sm" onclick="deleteItem(${index})">X</button></td>
                </tr>
            `).join('');

            invoicePreview.innerHTML = `
                <div class="invoice-header">
                    <div class="shop-details">
                        <h3>${shopName}</h3>
                        <p>${shopAddress}<br>${shopContact}<br>${shopGstin}</p>
                    </div>
                    <div id="qr-preview">
                        ${qrCodeImage ? `<img src="${qrCodeImage}" alt="QR Code">` : '<span>Upload QR</span>'}
                    </div>
                </div>
                
                <h4 class="text-center bg-light p-2 mb-3">TAX INVOICE</h4>

                <div class="row customer-details">
                    <div class="col-6">
                        <strong>Bill To:</strong><br>
                        ${customerName}<br>
                        ${customerAddress}<br>
                        ${customerContact}
                    </div>
                    <div class="col-6 text-end">
                        <strong>Invoice No:</strong> INV-${Date.now().toString().slice(-6)}<br>
                        <strong>Date:</strong> ${new Date().toLocaleDateString('en-IN')}
                    </div>
                </div>

                <table class="table invoice-table">
                    <thead>
                        <tr>
                            <th style="width:40%;">Item Description</th>
                            <th>Qty</th>
                            <th>Rate</th>
                            <th>GST%</th>
                            <th>Total</th>
                            <th class="no-print">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${itemsHtml || '<tr><td colspan="6" class="text-center">No items added yet.</td></tr>'}
                    </tbody>
                </table>

                <div class="invoice-footer">
                    <div class="terms">
                        <strong>Terms & Conditions:</strong>
                        <p>1. Goods once sold will not be taken back.<br>2. Thank you for your business!</p>
                    </div>
                    <table class="totals-table">
                        <tr><td>Sub Total:</td><td class="text-end">‚Çπ${subTotal.toFixed(2)}</td></tr>
                        <tr><td>CGST:</td><td class="text-end">‚Çπ${totalCgst.toFixed(2)}</td></tr>
                        <tr><td>SGST:</td><td class="text-end">‚Çπ${totalSgst.toFixed(2)}</td></tr>
                        <tr><td><strong>Grand Total:</strong></td><td class="text-end"><strong>‚Çπ${grandTotal.toFixed(2)}</strong></td></tr>
                    </table>
                </div>
            `;
        }
        
        /**
         * Saves invoice data to the SQL backend via API.
         */
        async function saveInvoiceToSQL(invoiceData) {
            if (invoiceData.items.length === 0) {
                showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø', '‡§ö‡§æ‡§≤‡§æ‡§® ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§', 'danger');
                return false;
            }
            try {
                // This calls your backend POST /api/save-invoice route
                const response = await fetchApi('/api/save-invoice', {
                    method: 'POST',
                    body: invoiceData 
                }, '‡§ö‡§æ‡§≤‡§æ‡§® ‡§°‡•á‡§ü‡§æ SQL ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...');
                
                if (response.success) {
                    return true;
                } else {
                    showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø', `‡§ö‡§æ‡§≤‡§æ‡§® ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü: ${response.message || '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø'}`, 'danger');
                    return false;
                }
            } catch (error) {
                showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø', `‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§è‡§∞‡§∞ (SQL ‡§∏‡•á‡§µ‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è): ${error.message}`, 'danger');
                return false;
            }
        }

        // New master function to handle both saving and downloading
        async function saveAndDownloadInvoicePDF() {
            // 1. Prepare Data to Save
            const invoiceData = {
                shopName: document.getElementById('shopName').value,
                shopAddress: document.getElementById('shopAddress').value,
                shopContact: document.getElementById('shopContact').value,
                shopGstin: document.getElementById('shopGstin').value,
                customerName: document.getElementById('customerName').value,
                customerAddress: document.getElementById('customerAddress').value,
                customerContact: document.getElementById('customerContact').value,
                items: items, // global items array
                qrCodeImage: qrCodeImage,
                date: new Date().toISOString().slice(0, 10),
                invoiceNumber: `INV-${Date.now().toString().slice(-6)}`, 
                grandTotal: items.reduce((acc, item) => acc + item.total, 0)
            };

            // 2. Save to SQL (via API)
            const saveSuccessful = await saveInvoiceToSQL(invoiceData);

            if (saveSuccessful) {
                showMessage('‡§∏‡§´‡§≤‡§§‡§æ', '‡§ö‡§æ‡§≤‡§æ‡§® ‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§Ö‡§¨ PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‡•§', 'success');
                // 3. Download PDF
                downloadInvoicePDF();
            }
        }

        function downloadInvoicePDF() {
            const invoiceElement = document.getElementById('invoice-preview');
            html2canvas(invoiceElement, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const canvasWidth = canvas.width;
                const canvasHeight = canvas.height;
                const ratio = canvasHeight / canvasWidth;
                const imgHeight = (pdfWidth - 20) * ratio;
                pdf.addImage(imgData, 'PNG', 10, 10, pdfWidth - 20, imgHeight);
                pdf.save(`invoice-${Date.now()}.pdf`);
            });
        }

        function printInvoice() {
            window.print();
        }

        function clearBill() {
            if (confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) {
                items = [];
                qrCodeImage = '';
                document.getElementById('shopName').value = '';
                document.getElementById('shopAddress').value = '';
                document.getElementById('shopContact').value = '';
                document.getElementById('shopGstin').value = '';
                document.getElementById('customerName').value = '';
                document.getElementById('customerAddress').value = '';
                document.getElementById('customerContact').value = '';
                document.getElementById('qrUpload').value = '';
                updateInvoicePreview();
                showMessage('‡§∏‡§´‡§≤‡§§‡§æ', '‡§¨‡§ø‡§≤ ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§', 'success');
            }
        }
        // --- END NEW INVOICE GENERATOR PRO FUNCTIONS ---

        // Dukan Pro Initialization
        window.onload = function() {
            const licenseModal = new bootstrap.Modal(document.getElementById('licenseModal'));
            const adminLoginModal = new bootstrap.Modal(document.getElementById('adminLoginModal'));

            const checkLicenseAndInit = async () => {
                const savedKey = localStorage.getItem("licenseKey");
                if (savedKey) {
                    try {
                        // üö® API route updated to /api/validate-key for 404 fix
                        const response = await fetchApi(`/api/validate-key?key=${encodeURIComponent(savedKey)}`, {}, '‡§≤‡§æ‡§á‡§∏‡•á‡§Ç‡§∏ ‡§ú‡§æ‡§Ç‡§ö‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...');
                        if (response.valid) {
                            unlockApplication();
                            return;
                        }
                        localStorage.removeItem("licenseKey");
                    } catch (err) {
                        console.error("License validation error on load:", err);
                        // Fallback to showing license modal
                    }
                }
                licenseModal.show();
            };

            const validateLicense = async (e) => {
                e.preventDefault();
                const key = document.getElementById("license-key-input").value;
                const licenseMsg = document.getElementById("license-message");
                const submitBtn = document.getElementById("license-submit-btn");
                submitBtn.disabled = true; licenseMsg.innerText = "‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à..."; licenseMsg.className = "text-muted small mt-2";
                
                try {
                    // üö® API route updated to /api/validate-key for 404 fix
                    const response = await fetchApi(`/api/validate-key?key=${encodeURIComponent(key)}`);
                    if (response.valid) {
                        localStorage.setItem("licenseKey", key);
                        licenseModal.hide();
                        showMessage('‡§∏‡§´‡§≤‡§§‡§æ', '‡§≤‡§æ‡§á‡§∏‡•á‡§Ç‡§∏ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à!', 'success');
                        unlockApplication();
                    } else {
                        licenseMsg.innerText = "‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§Ø‡§æ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã ‡§ö‡•Å‡§ï‡•Ä ‡§≤‡§æ‡§á‡§∏‡•á‡§Ç‡§∏ ‡§ï‡•Ä!";
                        licenseMsg.className = "text-danger small mt-2";
                        localStorage.removeItem("licenseKey");
                    }
                } catch (err) {
                     licenseMsg.innerText = err.message || "‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ ‡§∞‡§π‡§æ ‡§π‡•à!";
                     licenseMsg.className = "text-danger small mt-2";
                } finally {
                    submitBtn.disabled = false;
                }
            };

            document.getElementById('license-form').addEventListener('submit', validateLicense);

            // Dukan Pro UI/Navigation Logic
            document.querySelectorAll('#sidebar-nav .nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    renderView(this.getAttribute('data-view'));
                    document.getElementById('sidebar').classList.remove('active'); // Close sidebar on mobile
                });
            });

            // Initial view setup
            checkLicenseAndInit();

            // Admin Login Logic
            const openAdminModal = () => {
                document.getElementById("license-message").innerText = '';
                if(licenseModal._isShown) licenseModal.hide(); // Hide license modal if open
                document.getElementById('admin-password').value = '';
                document.getElementById('admin-login-message').innerText = '';
                adminLoginModal.show();
            };
            document.getElementById('admin-login-btn').addEventListener('click', openAdminModal);
            document.getElementById('open-admin-login-from-license-btn').addEventListener('click', openAdminModal);

            document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = document.getElementById('admin-login-submit-btn');
                const password = document.getElementById('admin-password').value;
                const msgEl = document.getElementById('admin-login-message');
                btn.disabled = true; msgEl.innerText = '';
                try {
                    const response = await fetchApi('/api/admin-login', { method: 'POST', body: { password } });
                    if (response.success) {
                        adminLoginModal.hide();
                        showMessage('‡§∏‡§´‡§≤‡§§‡§æ', '‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡§´‡§≤‡•§', 'success');
                        if (!AppState.isLicensed) unlockApplication();
                    } else {
                         msgEl.innerText = response.message || '‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°‡•§';
                    }
                } catch (error) {
                    msgEl.innerText = error.message;
                } finally {
                    btn.disabled = false;
                }
            });
             document.getElementById('menu-toggle').addEventListener('click', () => document.getElementById('sidebar').classList.toggle('active'));
        };
    </script>
</body>
</html>



